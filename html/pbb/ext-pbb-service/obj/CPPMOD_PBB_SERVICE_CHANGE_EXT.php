<?php
class cppmod_pbb_service_change_ext {
	public function setConn($pConnSw){
		$this->connSw = $pConnSw;
	}
	
	public function setVariableParams($pReq){
		foreach ($pReq as $a => $b) {
            $this->$a = $b;
        }
	}
	
	public function saveServiceChangeExt($pNOP,$pOPNum,$pLuasBangunan){
		$data = new \stdClass;
		$data->status = 0;
		 $query = "INSERT INTO cppmod_pbb_service_change_ext
					SELECT 
					CPM_SPPT_DOC_ID,CPM_SPPT_DOC_VERSION,CPM_OP_NUM,cpm_op_penggunaan,'{$pLuasBangunan}' CPM_OP_LUAS_BANGUNAN,CPM_OP_JML_LANTAI,CPM_OP_THN_DIBANGUN,CPM_OP_THN_RENOVASI,CPM_OP_DAYA,CPM_OP_KONDISI,CPM_OP_KONSTRUKSI,CPM_OP_ATAP,CPM_OP_DINDING,CPM_OP_LANTAI,CPM_OP_LANGIT,CPM_FOP_AC_SPLIT,CPM_FOP_AC_WINDOW,CPM_FOP_AC_CENTRAL,CPM_FOP_KOLAM_LUAS,CPM_FOP_KOLAM_LAPISAN,CPM_FOP_PERKERASAN_RINGAN,CPM_FOP_PERKERASAN_SEDANG,CPM_FOP_PERKERASAN_BERAT,CPM_FOP_PERKERASAN_PENUTUP,CPM_FOP_TENIS_LAMPU_BETON,CPM_FOP_TENIS_LAMPU_ASPAL,CPM_FOP_TENIS_LAMPU_TANAH,CPM_FOP_TENIS_TANPA_LAMPU_BETON,CPM_FOP_TENIS_TANPA_LAMPU_ASPAL,CPM_FOP_TENIS_TANPA_LAMPU_TANAH,CPM_FOP_LIFT_PENUMPANG,CPM_FOP_LIFT_KAPSUL,CPM_FOP_LIFT_BARANG,CPM_FOP_ESKALATOR_SEMPIT,CPM_FOP_ESKALATOR_LEBAR,CPM_FOP_SALURAN,CPM_FOP_SUMUR,CPM_PAYMENT_PENILAIAN_BGN,CPM_PAYMENT_SISTEM,CPM_PAYMENT_INDIVIDU,CPM_NJOP_BANGUNAN,CPM_PAGAR_BESI_PANJANG,CPM_PAGAR_BATA_PANJANG,CPM_PEMADAM_HYDRANT,CPM_PEMADAM_SPRINKLER,CPM_PEMADAM_FIRE_ALARM,CPM_JPB2_KELAS_BANGUNAN,CPM_JPB3_TINGGI_KOLOM,CPM_JPB3_DAYA_DUKUNG_LANTAI,CPM_JPB3_LEBAR_BENTANG,CPM_JPB3_KELILING_DINDING,CPM_JPB3_LUAS_MEZZANINE,CPM_JPB4_KELAS_BANGUNAN,CPM_JPB5_KELAS_BANGUNAN,CPM_JPB5_LUAS_KMR_AC_CENTRAL,CPM_JPB5_LUAS_RUANG_AC_CENTRAL,CPM_JPB6_KELAS_BANGUNAN,CPM_JPB7_JENIS_HOTEL,CPM_JPB7_JUMLAH_BINTANG,CPM_JPB7_JUMLAH_KAMAR,CPM_JPB7_LUAS_KMR_AC_CENTRAL,CPM_JPB7_LUAS_RUANG_AC_CENTRAL,CPM_JPB8_TINGGI_KOLOM,CPM_JPB8_DAYA_DUKUNG_LANTAI,CPM_JPB8_LEBAR_BENTANG,CPM_JPB8_KELILING_DINDING,CPM_JPB8_LUAS_MEZZANINE,CPM_JPB9_KELAS_BANGUNAN,CPM_JPB12_TIPE_BANGUNAN,CPM_JPB13_JUMLAH_APARTEMEN,CPM_JPB13_KELAS_BANGUNAN,CPM_JPB13_LUAS_APARTEMEN_AC_CENTRAL,CPM_JPB13_LUAS_RUANG_AC_CENTRAL,CPM_JPB15_TANGKI_MINYAK_KAPASITAS,CPM_JPB15_TANGKI_MINYAK_LETAK,CPM_JPB16_KELAS_BANGUNAN
					FROM cppmod_pbb_sppt_ext_final WHERE CPM_SPPT_DOC_ID = 
					(SELECT CPM_SPPT_DOC_ID FROM cppmod_pbb_sppt_final WHERE CPM_NOP='{$pNOP}' and CPM_OP_NUM='{$pOPNum}')
					UNION ALL
					SELECT 
					CPM_SPPT_DOC_ID,CPM_SPPT_DOC_VERSION,CPM_OP_NUM,cpm_op_penggunaan,'{$pLuasBangunan}' CPM_OP_LUAS_BANGUNAN,CPM_OP_JML_LANTAI,CPM_OP_THN_DIBANGUN,CPM_OP_THN_RENOVASI,CPM_OP_DAYA,CPM_OP_KONDISI,CPM_OP_KONSTRUKSI,CPM_OP_ATAP,CPM_OP_DINDING,CPM_OP_LANTAI,CPM_OP_LANGIT,CPM_FOP_AC_SPLIT,CPM_FOP_AC_WINDOW,CPM_FOP_AC_CENTRAL,CPM_FOP_KOLAM_LUAS,CPM_FOP_KOLAM_LAPISAN,CPM_FOP_PERKERASAN_RINGAN,CPM_FOP_PERKERASAN_SEDANG,CPM_FOP_PERKERASAN_BERAT,CPM_FOP_PERKERASAN_PENUTUP,CPM_FOP_TENIS_LAMPU_BETON,CPM_FOP_TENIS_LAMPU_ASPAL,CPM_FOP_TENIS_LAMPU_TANAH,CPM_FOP_TENIS_TANPA_LAMPU_BETON,CPM_FOP_TENIS_TANPA_LAMPU_ASPAL,CPM_FOP_TENIS_TANPA_LAMPU_TANAH,CPM_FOP_LIFT_PENUMPANG,CPM_FOP_LIFT_KAPSUL,CPM_FOP_LIFT_BARANG,CPM_FOP_ESKALATOR_SEMPIT,CPM_FOP_ESKALATOR_LEBAR,CPM_FOP_SALURAN,CPM_FOP_SUMUR,CPM_PAYMENT_PENILAIAN_BGN,CPM_PAYMENT_SISTEM,CPM_PAYMENT_INDIVIDU,CPM_NJOP_BANGUNAN,CPM_PAGAR_BESI_PANJANG,CPM_PAGAR_BATA_PANJANG,CPM_PEMADAM_HYDRANT,CPM_PEMADAM_SPRINKLER,CPM_PEMADAM_FIRE_ALARM,CPM_JPB2_KELAS_BANGUNAN,CPM_JPB3_TINGGI_KOLOM,CPM_JPB3_DAYA_DUKUNG_LANTAI,CPM_JPB3_LEBAR_BENTANG,CPM_JPB3_KELILING_DINDING,CPM_JPB3_LUAS_MEZZANINE,CPM_JPB4_KELAS_BANGUNAN,CPM_JPB5_KELAS_BANGUNAN,CPM_JPB5_LUAS_KMR_AC_CENTRAL,CPM_JPB5_LUAS_RUANG_AC_CENTRAL,CPM_JPB6_KELAS_BANGUNAN,CPM_JPB7_JENIS_HOTEL,CPM_JPB7_JUMLAH_BINTANG,CPM_JPB7_JUMLAH_KAMAR,CPM_JPB7_LUAS_KMR_AC_CENTRAL,CPM_JPB7_LUAS_RUANG_AC_CENTRAL,CPM_JPB8_TINGGI_KOLOM,CPM_JPB8_DAYA_DUKUNG_LANTAI,CPM_JPB8_LEBAR_BENTANG,CPM_JPB8_KELILING_DINDING,CPM_JPB8_LUAS_MEZZANINE,CPM_JPB9_KELAS_BANGUNAN,CPM_JPB12_TIPE_BANGUNAN,CPM_JPB13_JUMLAH_APARTEMEN,CPM_JPB13_KELAS_BANGUNAN,CPM_JPB13_LUAS_APARTEMEN_AC_CENTRAL,CPM_JPB13_LUAS_RUANG_AC_CENTRAL,CPM_JPB15_TANGKI_MINYAK_KAPASITAS,CPM_JPB15_TANGKI_MINYAK_LETAK,CPM_JPB16_KELAS_BANGUNAN
					FROM cppmod_pbb_sppt_ext_susulan WHERE CPM_SPPT_DOC_ID = 
					(SELECT CPM_SPPT_DOC_ID FROM cppmod_pbb_sppt_susulan WHERE CPM_NOP='{$pNOP}' and CPM_OP_NUM='{$pOPNum}')";
		// echo $query;exit;
		try {
			$stmt = $this->connSw->prepare($query);
			$res = $stmt->execute();
			$data->msg = ($res) ? "Simpan perubahan data service ext berhasil" : "Simpan perubahan data service ext gagal";
			$data->rc = ($res) ? 1 : 0;
		}catch(Exception $e) {
			echo 'Exception Service Change Ext -> ';
			var_dump($e->getMessage());
			die();
		}
		return $data;				
	}
	
	public function delServiceChangeExt($pDocId){
		$data = new \stdClass;
		$data->status = 0;
		$query = "DELETE FROM cppmod_pbb_service_change_ext where CPM_SPPT_DOC_ID='{$pDocId}'";
		// echo $query;exit;
		try {
			$stmt = $this->connSw->prepare($query);
			$res = $stmt->execute();
			$data->msg = ($res) ? "Hapus perubahan data service ext berhasil" : "Hapus perubahan data service ext gagal";
			$data->rc = ($res) ? 1 : 0;
		}catch(Exception $e) {
			echo 'Exception Service Change Ext -> ';
			var_dump($e->getMessage());
			die();
		}
		return $data;	
	}
}
?>