<?php
session_start();
$DIR = "PATDA-V1-PLG";
$modul = "monitoring";
$submodul = "tran-hotel";

$sRootPath = str_replace('\\', '/', str_replace(DIRECTORY_SEPARATOR . 'view' . DIRECTORY_SEPARATOR . $DIR . DIRECTORY_SEPARATOR . $modul . DIRECTORY_SEPARATOR . $submodul, '', dirname(__FILE__))) . '/';
require_once($sRootPath . "inc/payment/json.php");
require_once($sRootPath . "function/{$DIR}/class-pajak.php");
require_once($sRootPath . "function/{$DIR}/{$modul}/class-tran-hotel.php");
$json = new Services_JSON(SERVICES_JSON_SUPPRESS_ERRORS);
$q = $json->decode(base64_decode($_REQUEST['q']));

$_REQUEST['a'] = $q->a;
$_REQUEST['m'] = $q->m;
$_REQUEST['i'] = 1;

$tran = new TransaksiHotel();
?>
<script type="text/javascript">
    var table = "";
    var loadajax = "<img src='image/icon/ajax-loader.gif' style='border-radius:20px'>";
    
    $(document).ready(function(){
		
    });
	
    function get_resume(){
	     var allid = '';
	     $('.loadsign').html("<img src='inc/PATDA-V1-PLG/img/ui-anim_basic_16x16.gif'>");
	     $('.deviceidstr').each(function(){
		     allid += $(this).attr('deviceid')+'|';
	     })
	     $.ajax({
		     type:'post',
		     data:{allid:allid},
		     url : "view/<?php echo $DIR."/".$modul."/".$submodul?>/svc-tran-hotel.php?function=get_resume&a=<?php echo $q->a?>&m=<?php echo $q->m?>",
		     dataType:'json',
		     success:function(res){
				
			    $('.loadsign').html('');
			    // modify : "today" to "yesterday" [OST - 24/04/2018]
			    $('.transaksi_kemarin').html('<a href="javascript:void(0)" onclick="javascript:get_tran(\'yesterday\',\'<?=$_REQUEST['i']?>\')">'+res.transaksi_kemarin+'</a>');
			    $('.transaksi_bulan_ini').html('<a href="javascript:void(0)" onclick="javascript:get_tran(\'this_month\',\'<?=$_REQUEST['i']?>\')">'+res.transaksi_bulan_ini+'</a>');
		     }
	     });
    }

    function reloadAllStatus(){
    	$('#table-status').jtable('load', {
			CPM_NPWPD : $('#CPM_NPWPD-2').val(),
			CPM_JENIS_PAJAK : $('#CPM_JENIS_PAJAK-2').val()
		});
    }
    
    function get_tran(type, id){
		var now = new Date();
		var y = <?=date('Y')?>;
		var m = <?=date('m')?>;
		var d = <?=date('d')?>;
		
		//--- Add : previous day [OST - 24/04/2018]
		var prevY = <?=date('Y', (time() - 60 * 60 * 24))?>;
		var prevM = <?=date('m', (time() - 60 * 60 * 24))?>;
		var prevD = <?=date('d', (time() - 60 * 60 * 24))?>;
		
		var prevDate = new Date(prevY, prevM-1, prevD);
		//---
		
		var currentDate = new Date(y, m, d);
		var prevMonthLastDate = new Date(y, m, 0);
		var prevMonthFirstDate = new Date(y, (m - 1 + 12) % 12, 1);

		var formatDateComponent = function(dateComponent) {
			return (dateComponent < 10 ? '0' : '') + dateComponent;
		};

		var formatDate = function(date) {
			return formatDateComponent(date.getDate()) + '-' + formatDateComponent(date.getMonth() + 1) + '-' + date.getFullYear();
		};
		
		//--- Add & comments : yesterday [OST - 24/04/2018]
		$('#TRAN_DATE1-'+id).val((type === 'yesterday')? formatDate(prevDate) : formatDate(prevMonthFirstDate));
		$('#TRAN_DATE2-'+id).val((type === 'yesterday')? formatDate(prevDate) : formatDate(prevMonthLastDate));
		//---	
		
		//$('#TRAN_DATE1-'+id).val((type === 'today')? formatDate(currentDate) : formatDate(prevMonthFirstDate));
		//$('#TRAN_DATE2-'+id).val((type === 'today')? formatDate(currentDate) : formatDate(prevMonthLastDate));		
		$('#cari-'+id).trigger('click');
	}
</script>
<div class="row">
	<input type="hidden" id="strdeviceid">
	<div class="col-lg-9">
		<div class="panel panel-default">
			<div class="panel-heading">
			</div>
			
			<div class="panel-body">
				<div class="row">
					<div class="col-lg-12">
						<?php $tran->grid_table_pembanding_detail();?>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-lg-3">
		<div class="panel panel-default">
			<div class="panel-heading">
				<i class="fa fa-bell fa-fw"></i> Dashboard
			</div>						
			<div class="panel-body">
				<div class="list-group">
				    <a class="list-group-item">
						<!-- modify : "Transaksi Hari ini" to "Transaksi Kemarin"  [OST - 24/04/2018] -->
					   <i class="fa fa-check text-success"></i> Transaksi Hari Kemarin : <br/><b class='transaksi_kemarin'><img src='inc/PATDA-V1-PLG/img/ui-anim_basic_16x16.gif'></b>
				    </a>
				    <a class="list-group-item">
					   <i class="fa fa-check text-success"></i> Transaksi Bulan ini : <br/><b class='transaksi_bulan_ini'><img src='inc/PATDA-V1-PLG/img/ui-anim_basic_16x16.gif'></b>
				    </a>
				</div>
			</div>
		</div>
	</div>
</div>
